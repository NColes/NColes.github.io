<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="icon" href="http://ncoles.github.io/favicon.ico">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

  <title>Custom release sheet</title>

  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.12/datatables.min.css" />
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.2.1/css/buttons.dataTables.min.css" />

  <link href="http://ncoles.github.io/style.css" rel="stylesheet">
  <link href="http://ncoles.github.io/bootstrap.min.css" rel="stylesheet">
  <link href="http://ncoles.github.io/css/justified-nav.css" rel="stylesheet">
  <link href="http://ncoles.github.io/releasesheet/style.css" rel="stylesheet">

  <script type="text/javascript" src="http://ncoles.github.io/js-control/tooltip.js"></script>

  <script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.12/datatables.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/1.2.1/js/dataTables.buttons.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js"></script>
  <script src="https://cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/vfs_fonts.js"></script>
  <script src="https://cdn.datatables.net/buttons/1.2.1/js/buttons.html5.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>




  <!-- Tag-it CSS -->
  <link href="http://aehlke.github.io/tag-it/css/jquery.tagit.css" rel="stylesheet" type="text/css">
  <link href="http://aehlke.github.io/tag-it/css/tagit.ui-zendesk.css" rel="stylesheet" type="text/css">

  <!-- Tag-it JS -->
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  <script src="http://aehlke.github.io/tag-it/js/tag-it.js" type="text/javascript" charset="utf-8"></script>


  <script>
searchKeywordsArray = [];
$(function() {

  $('#inputTags').tagit({
    allowSpaces: true,
    singleField: true,
    singleFieldNode: $('#searchKeywords'),
    autocomplete: {
      delay: 0,
      minLength: 2
    }
  });

});


$("#inputTags").tagit("assignedTags");
  </script>



  <style>
.box {
  background-color: #7A1A13;
  border: 1px solid white;
  color: white;
  margin: 10px;
  text-align: center;
}

.box h4 {
  border-bottom: 1px solid white;
  padding: 20px 10px 20px 15px;
  margin: 0px;
}

.boxContent {
  margin: 15px;
}

h3 a {
  color: inherit;
  text-decoration: none;
}

#form-table td {
  padding-top: 5px;
  padding-bottom: 5px;
}

#form-table button {
  width: 90%;
}
	  
.btn-group-vertical>.btn-group:after, .btn-toolbar:after, .clearfix:after, .container-fluid:after, .container:after, .dl-horizontal dd:after, .form-horizontal .form-group:after, .modal-footer:after, .modal-header:after, .nav:after, .navbar-collapse:after, .navbar-header:after, .navbar:after, .pager:after, .panel-body:after, .row:after {
    clear: none;
}

.ui-helper-hidden-accessible {
	display:none;
}
  </style>

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body onresize="resizePublished()">

  <div class="container">

    <div class="masthead">

      <h3 class="text-muted">Custom release sheet</h3>
      <nav>
        <ul class="nav nav-justified">
          <li><a href="../index.html">Home</a></li>
          <li><a href="../metadata/index.html">Metadata tool</a></li>
          <li class="active"><a href="#">Release sheet</a></li>
          <li><a href="../timeseries/index.html">Timeseries</a></li>
        </ul>
      </nav>
    </div>
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-4">
        </div>
        <div class="col-lg-4">
          <div class="well">
            <table id="form-table">
              <tr>
                <td><label for="start">Start date:</label></td>
                <td><label for="end">End date:</label></td>
              </tr>

              <tr>
                <td><input id="start" type="date" required></td>
                <td><input id="end" type="date" required></td>
              </tr>
              <tr class="collapseHeader">
                <td colspan="2"><a href="#">Advanced options</a></td>
              </tr>
              <tr style="display:none;">
                <td colspan="2">Show me:</td>
              </tr>
              <tr style="display:none;">
                <label class="clickme">
<td>Timeseries</td><td><input id="selectTimeseries" type="checkbox"></td>
    </label>
              </tr>
              <tr style="display:none;">
                <label class="clickme"><td>Market sensitive</td><td><input id="selectMS" type="checkbox"></td></label>
              </tr>
              <tr style="display:none;">
                <label class="clickme"><td>Dashboard and tracking table</td><td><input id="selectDashboard" type="checkbox"></td></label>
              </tr>
              <tr style="display:none;">
                <td colspan="2">Keywords:</td>
              </tr>
              <tr style="display:none;">
                <td colspan="2">
                  <form>
                    <ul id="inputTags"></ul>
                  </form>
                </td>
              </tr>

              <tr class="collapseHeader"></tr>
              <tr>
                <td colspan="2"><button class="standardButton" onclick="customSheet()">Generate sheet</button></td>
              </tr>
            </table>
          </div>
        </div>
        <div class="col-lg-4">
        </div>
      </div>
      <div class="row">
        <div class="col-lg-12" id="upcomingBox" style="display:none;">
          <div class="well">
            <h3>Custom release sheet</h3>
	    <input name="tags" id="searchKeywords" disabled="true" style="display:none;">
            <table id="customTable" class="table table-hover">
              <thead>
                <tr>
                  <th>
                    <div id="periodDate"></div>
                  </th>
                  <th colspan="2" id="dlbuttons" class="tableData">
                  </th>

                </tr>
                <tr>
                  <th class="tableText" style="width:68%">Release</th>
                  <th class="tableData" style="width:12%"></th>
                  <th class="tableData" style="width:20%">Publishing date</th>
                  <th class="tableData" style="display:none;">Unformatted date</th>
                </tr>
              </thead>
              <tbody id="publishedreleases"></tbody>
            </table>

          </div>
        </div>
      </div>
    </div>


    <script src="releaseCalendarCustom.js"></script>
    <script src="http://ncoles.github.io/js-control/msts.js"></script>


    <script>
var today = new Date();
var dd = today.getDate();
ddT = today.getDate() + 1;
var mm = today.getMonth() + 1; //January is 0!
var yyyy = today.getFullYear();
if (dd < 10) {
  dd = '0' + dd
};

if (mm < 10) {
  mm = '0' + mm
};

today = yyyy + '-' + mm + '-' + dd;

document.getElementById("start").setAttribute("min", today);
document.getElementById("end").setAttribute("min", today);
document.getElementById("start").value = today;

start.addEventListener('change', function() {
  if (start.value)
    end.min = start.value;
}, false);

end.addEventListener('change', function() {
  if (end.value)
    start.max = end.value;
}, false);


var tableDrawn = false;
	    
daysInMonth = function(month,year) {
    return new Date(year, month, 0).getDate();
}

customSheet = function() {

  if (start.value === "" | end.value === "") {
    alert("Please fill in start and end dates");
  } else {    

    searchKeywordsArray = document.getElementById("searchKeywords").value.split(",");

    document.getElementById("upcomingBox").setAttribute("style", "display:block;");
    startDate = start.value;
    startDate = new Date(startDate);

    endDate = end.value;
    endDate = new Date(endDate);

    startDay = start.value.substring(8, 10);
    startMonth = start.value.substring(5, 7);
    startYear = start.value.substring(0, 4);

    endYear = end.value.substring(0, 4);

    if (Number(end.value.substring(8, 10)) + 1 > daysInMonth(end.value.substring(5, 7),end.value.substring(0, 4))) {
	console.log("Invalid date produced");
        endDay = 1;
        endMonth = Number(end.value.substring(5, 7)) + 1;
    } else {
	endMonth = end.value.substring(5, 7);
        endDay = Number(end.value.substring(8, 10)) + 1;
    };

    customURL = "https://www.ons.gov.uk/releasecalendar/data?query=&fromDateDay=" + startDay + "&fromDateMonth=" + startMonth + "&fromDateYear=" + startYear + "&toDateDay=" + endDay + "&toDateMonth=" + endMonth + "&toDateYear=" + endYear + "&view=upcoming&size=250";

    generateCustomTable(function() {

     var createCustom = $('#customTable').dataTable({
        "lengthChange": false,
        "pageLength": 15,
        "autoWidth": false,
        "searching": false,
        "language": {
          "zeroRecords": "No releases found."
        },
        "order": [
          [3, "asc"]
        ],
        "columnDefs": [{
          "targets": 3,
          "visible": false
        }],
        "drawCallback": function(settings) {
          $('[data-toggle="tooltip"]').tooltip();
        }
      });

      var buttons = new $.fn.dataTable.Buttons(createCustom, {
        "buttons": [

          {
            "extend": 'csvHtml5',
            "exportOptions": {
              "columns": ':visible'
            }
          }, {
            "extend": 'excelHtml5',
            "exportOptions": {
              "columns": ':visible'
            }
          }
        ]
      }).container().appendTo($('#dlbuttons'));

      bindUpcomingButtons();
      var tableDrawn = true;
    });

  };

};
    </script>

    <script>
var addingTags = document.getElementById("searchKeywords");

addingTags.addEventListener('change', function() {
  console.log("Tag added");
  if (addingTags.value != "")
    console.log("Tag added");
}, false);
    </script>

    <!-- /container -->

</body>

</html>
